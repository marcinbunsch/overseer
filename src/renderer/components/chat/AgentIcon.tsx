import { observer } from "mobx-react-lite"
import type { AgentType } from "../../types"
import { toolAvailabilityStore } from "../../stores/ToolAvailabilityStore"

interface AgentIconProps {
  agentType?: AgentType
  size?: number
  className?: string
  showWarning?: boolean
}

export function ClaudeIcon({ size = 14, className }: { size?: number; className?: string }) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 16 16"
      fill="currentColor"
      className={className}
      aria-label="Claude"
    >
      <path d="m3.127 10.604 3.135-1.76.053-.153-.053-.085H6.11l-.525-.032-1.791-.048-1.554-.065-1.505-.08-.38-.081L0 7.832l.036-.234.32-.214.455.04 1.009.069 1.513.105 1.097.064 1.626.17h.259l.036-.105-.089-.065-.068-.064-1.566-1.062-1.695-1.121-.887-.646-.48-.327-.243-.306-.104-.67.435-.48.585.04.15.04.593.456 1.267.981 1.654 1.218.242.202.097-.068.012-.049-.109-.181-.9-1.626-.96-1.655-.428-.686-.113-.411a2 2 0 0 1-.068-.484l.496-.674L4.446 0l.662.089.279.242.411.94.666 1.48 1.033 2.014.302.597.162.553.06.17h.105v-.097l.085-1.134.157-1.392.154-1.792.052-.504.25-.605.497-.327.387.186.319.456-.045.294-.19 1.23-.37 1.93-.243 1.29h.142l.161-.16.654-.868 1.097-1.372.484-.545.565-.601.363-.287h.686l.505.751-.226.775-.707.895-.585.759-.839 1.13-.524.904.048.072.125-.012 1.897-.403 1.024-.186 1.223-.21.553.258.06.263-.218.536-1.307.323-1.533.307-2.284.54-.028.02.032.04 1.029.098.44.024h1.077l2.005.15.525.346.315.424-.053.323-.807.411-3.631-.863-.872-.218h-.12v.073l.726.71 1.331 1.202 1.667 1.55.084.383-.214.302-.226-.032-1.464-1.101-.565-.497-1.28-1.077h-.084v.113l.295.432 1.557 2.34.08.718-.112.234-.404.141-.444-.08-.911-1.28-.94-1.44-.759-1.291-.093.053-.448 4.821-.21.246-.484.186-.403-.307-.214-.496.214-.98.258-1.28.21-1.016.19-1.263.112-.42-.008-.028-.092.012-.953 1.307-1.448 1.957-1.146 1.227-.274.109-.477-.247.045-.44.266-.39 1.586-2.018.956-1.25.617-.723-.004-.105h-.036l-4.212 2.736-.75.096-.324-.302.04-.496.154-.162 1.267-.871z" />
    </svg>
  )
}

export function OpenAIIcon({ size = 14, className }: { size?: number; className?: string }) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 24 24"
      fill="currentColor"
      className={className}
      aria-label="OpenAI"
    >
      <path d="M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.872zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08L8.704 5.46a.795.795 0 0 0-.393.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z" />
    </svg>
  )
}

export function GitHubCopilotIcon({ size = 14, className }: { size?: number; className?: string }) {
  // Logo extracted from GitHub Copilot (2025) branding
  // Source: https://upload.wikimedia.org/wikipedia/commons/0/0a/GitHub_Copilot_%282025%29.svg
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 50 42"
      fill="currentColor"
      className={className}
      aria-label="GitHub Copilot"
    >
      <path d="M29.8768 25.3531C30.9809 25.3531 31.876 26.2481 31.876 27.3522V31.3505C31.876 32.4545 30.9809 33.3496 29.8768 33.3496C28.7727 33.3496 27.8777 32.4545 27.8777 31.3505V27.3522C27.8777 26.2481 28.7727 25.3531 29.8768 25.3531Z" />
      <path d="M21.8803 27.3522C21.8803 26.2481 20.9852 25.3531 19.8812 25.3531C18.7771 25.3531 17.882 26.2481 17.882 27.3522V31.3505C17.882 32.4545 18.7771 33.3496 19.8812 33.3496C20.9852 33.3496 21.8803 32.4545 21.8803 31.3505V27.3522Z" />
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M48.6801 30.8403C46.9603 33.8278 36.974 40.8772 24.8601 40.8772C12.7462 40.8772 2.75994 33.8278 1.04014 30.8403C0.914376 30.6218 0.873779 30.3723 0.873779 30.1202V24.8018C0.873779 24.5813 0.907813 24.3622 0.989389 24.1574C1.73309 22.2899 3.68082 19.5773 6.19449 18.8495C6.52774 17.994 7.02133 16.7433 7.48186 15.8201C7.40477 15.1138 7.37764 14.3853 7.37764 13.6492C7.37764 10.99 7.9413 8.65743 9.63975 6.92044C10.433 6.10915 11.4174 5.48684 12.5847 5.01903C15.3805 2.74775 19.3616 0.837036 24.8169 0.837036C30.2723 0.837036 34.3398 2.74775 37.1355 5.01903C38.3028 5.48684 39.2872 6.10915 40.0805 6.92044C41.7789 8.65743 42.3426 10.99 42.3426 13.6492C42.3426 14.3853 42.3154 15.1138 42.2384 15.8201C42.6989 16.7433 43.1925 17.994 43.5257 18.8495C46.0394 19.5773 47.9871 22.2899 48.7308 24.1574C48.8124 24.3622 48.8464 24.5813 48.8464 24.8018V30.1202C48.8464 30.3723 48.8058 30.6218 48.6801 30.8403ZM26.485 13.0046C26.4 12.3422 26.3595 11.749 26.3584 11.2191L26.3584 11.1772C26.361 9.63975 26.6971 8.63938 27.2339 8.02499C27.9156 7.2448 29.3246 6.64707 32.2941 6.96844C35.3026 7.29402 36.9842 8.04072 37.9376 9.01574C38.8606 9.95971 39.3455 11.372 39.3455 13.6492C39.3455 16.0687 38.9969 17.4982 38.2302 18.3678C37.5012 19.1946 36.0656 19.8674 32.9214 19.8674C30.5041 19.8674 29.1221 19.0812 28.2386 17.9939C27.2899 16.8264 26.7559 15.1161 26.485 13.0046ZM23.2353 13.0046C23.3203 12.3422 23.3607 11.749 23.3619 11.2191L23.3619 11.1772C23.3592 9.63974 23.0232 8.63937 22.4863 8.02498C21.8046 7.24479 20.3957 6.64707 17.4261 6.96843C14.4176 7.29402 12.736 8.04071 11.7826 9.01573C10.8596 9.9597 10.3747 11.372 10.3747 13.6492C10.3747 16.0687 10.7234 17.4982 11.49 18.3677C12.219 19.1946 13.6546 19.8674 16.7989 19.8674C19.2161 19.8674 20.5981 19.0812 21.4816 17.9939C22.4304 16.8264 22.9643 15.1161 23.2353 13.0046ZM25.2042 18.8676L25.0543 18.8676C24.8715 18.8678 24.6005 18.868 24.516 18.8676C24.3045 19.2218 24.0693 19.5618 23.8075 19.884C22.2697 21.7764 19.9741 22.8644 16.7988 22.8644C13.3524 22.8644 10.8266 22.1471 9.24196 20.3498C9.15187 20.2476 9.07125 20.1406 9.07125 20.1406L8.87613 20.3498V33.5049C11.7429 35.0628 17.8959 37.8586 24.8601 37.8586C31.8243 37.8586 37.9773 35.0628 40.8441 33.5049V20.3498L40.649 20.1406C40.649 20.1406 40.5829 20.231 40.4783 20.3498C38.8936 22.1471 36.3678 22.8644 32.9214 22.8644C29.7461 22.8644 27.4506 21.7764 25.9127 19.884C25.6509 19.5618 25.4157 19.2218 25.2042 18.8676Z"
      />
    </svg>
  )
}

export function GeminiIcon({ size = 14, className }: { size?: number; className?: string }) {
  // Google Gemini sparkle icon
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 28 28"
      fill="currentColor"
      className={className}
      aria-label="Gemini"
    >
      <path d="M14 28C14 26.0633 13.6267 24.2433 12.88 22.54C12.1567 20.8367 11.165 19.355 9.905 18.095C8.645 16.835 7.16333 15.8433 5.46 15.12C3.75667 14.3733 1.93667 14 0 14C1.93667 14 3.75667 13.6383 5.46 12.915C7.16333 12.1683 8.645 11.165 9.905 9.905C11.165 8.645 12.1567 7.16333 12.88 5.46C13.6267 3.75667 14 1.93667 14 0C14 1.93667 14.3617 3.75667 15.085 5.46C15.8317 7.16333 16.835 8.645 18.095 9.905C19.355 11.165 20.8367 12.1683 22.54 12.915C24.2433 13.6383 26.0633 14 28 14C26.0633 14 24.2433 14.3733 22.54 15.12C20.8367 15.8433 19.355 16.835 18.095 18.095C16.835 19.355 15.8317 20.8367 15.085 22.54C14.3617 24.2433 14 26.0633 14 28Z" />
    </svg>
  )
}

export function OpenCodeIcon({ size = 14, className }: { size?: number; className?: string }) {
  // OpenCode official logo - geometric frame with inner square
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 240 300"
      fill="currentColor"
      className={className}
      aria-label="OpenCode"
    >
      <path d="M180 240H60V120H180V240Z" fillOpacity="0.4" />
      <path d="M180 60H60V240H180V60ZM240 300H0V0H240V300Z" />
    </svg>
  )
}

function WarningIcon({ size = 10 }: { size?: number }) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 16 16"
      fill="currentColor"
      className="text-ovr-warn"
      aria-label="Warning"
    >
      <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2" />
    </svg>
  )
}

export const AgentIcon = observer(function AgentIcon({
  agentType,
  size = 14,
  className,
  showWarning = false,
}: AgentIconProps) {
  // Check if we should show warning based on tool availability
  const toolStatus = (() => {
    switch (agentType) {
      case "claude":
        return toolAvailabilityStore.claude
      case "codex":
        return toolAvailabilityStore.codex
      case "copilot":
        return toolAvailabilityStore.copilot
      case "gemini":
        return toolAvailabilityStore.gemini
      case "opencode":
        return toolAvailabilityStore.opencode
      default:
        return null
    }
  })()
  const isUnavailable = showWarning && toolStatus !== null && !toolStatus.available

  const icon = (() => {
    switch (agentType) {
      case "claude":
        return <ClaudeIcon size={size} className={className} />
      case "codex":
        return <OpenAIIcon size={size} className={className} />
      case "copilot":
        return <GitHubCopilotIcon size={size} className={className} />
      case "gemini":
        return <GeminiIcon size={size} className={className} />
      case "opencode":
        return <OpenCodeIcon size={size} className={className} />
      default:
        return null
    }
  })()

  if (!isUnavailable) {
    return icon
  }

  // Show icon with warning overlay
  return (
    <span className="relative inline-flex" title={toolStatus?.error || "Agent not available"}>
      {icon}
      <span className="absolute -right-1 -top-1">
        <WarningIcon size={Math.max(8, size * 0.6)} />
      </span>
    </span>
  )
})
